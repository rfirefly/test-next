window.trackFormMixin={props:{config:{type:Number,require:!0},isGoSearch:{type:Boolean,default:!1}},data(){return{translation:{},configure_options:{},additional_text:{},formParams:{email:"",order_or_number:"",tracking_no:"",tracking_no_or_order_number:"",select_type:""},showOrderError:!1,showEmailError:!1,showTrackingNoError:!1,showTrackingNoOrOrderNumberError:!1,showPowerBy:!1,poweredByText:"Powered by ",showTab:1,showLoading:!1,showErrorText:!1,storeDomain:""}},computed:{isOrderNumberAndEmailAndTrackingNumber(){return this.configure_options.lookup_options_by_order_number_and_email&&this.configure_options.require_email_or_phone_number&&this.configure_options.lookup_options_by_tracking_number},baseUrl(){return TRACK_BASE_URL||window.TRACK_BASE_URL},isPhone(){return navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)}},created(){this.additional_text={...this.config.additional_text},this.configure_options={...this.config.configure_options}},mounted(){try{this.storeDomain=Shopify.shop||this.config.shopify_domain}catch(t){this.storeDomain=this.config.shopify_domain||TRACK_DOMAIN||window.TRACK_DOMAIN}"my-shoot-box.myshopify.com"==this.storeDomain?setTimeout(()=>{this.translation=this.getTranslation()},100):this.translation=this.getTranslation(),this.getPageSessionId(),this.init(),this.initGoogleAlign(),this.insertGoogleAnalyticsCode()},methods:{insertGoogleAnalyticsCode(){fetch(this.baseUrl+"/endApi/api/third/apps/google-analytics?storeDomain="+this.storeDomain,{method:"GET",headers:{Accept:"application/json, */*","Content-Type":"application/json;charset=utf8"}}).then(t=>t.json()).then(t=>{var e,i,t=t.data.ga4_id;t&&((e=document.createElement("script")).async=!0,e.src="https://www.googletagmanager.com/gtag/js?id="+t,(i=document.createElement("script")).text=`
						window.dataLayer = window.dataLayer || [];
						function gtag() { dataLayer.push(arguments);}
						gtag('js', new Date());
						gtag('config', '${t}');
					`,document.getElementsByTagName("head")[0].appendChild(e),document.getElementsByTagName("head")[0].appendChild(i))})},init(){var t=window.TRACK123_BASE64;let e=this.getQueryVariable("nums")||"";var i=this.getQueryVariable("id"),r=this.getQueryVariable("order");e?(e=decodeURIComponent(e),this.showTab=2):(i||r)&&(i&&(this.formParams.email=t.decode(decodeURIComponent(i))),r&&(this.formParams.order_or_number=decodeURIComponent(r),this.formParams.tracking_no_or_order_number=decodeURIComponent(r)),this.isGoSearch||(i?this.submit(1):r&&this.config.configure_options.lookup_options_by_order_number_and_email&&!this.config.configure_options.require_email_or_phone_number&&this.submit(3))),this.getParams(e)},getPageSessionId(){fetch(this.baseUrl+"/endApi/api/upload-marketing",{method:"POST",body:JSON.stringify({click_type:0,store_domain:this.storeDomain}),headers:{Accept:"application/json, */*","Content-Type":"application/json;charset=utf8"}}).then(t=>t.json()).then(t=>{"00000"==t.code&&t.data&&(window.TRACK_PAGE_SESSION_ID=t.data)})},getModernMultiLanguage(){if(!this.config.style||"modern"==this.config.style.theme){let t="";var e=window.location.href.split("/");return t=["apps","a","community","tools"].includes(e[3])?t:(t=e[3])&&t.split("-")[0]}},getTranslation(){let i=null;const r=this.getModernMultiLanguage();var t=this.config.translation_configs&&this.config.translation_configs.translation_configs&&this.config.translation_configs.translation_configs.length?this.config.translation_configs.translation_configs[0].translation:{};this.config.translation_configs.func_permission||this.config.translation_configs.plan;return this.config.translation_configs.translation_configs.forEach(t=>{var e=t.code.split("-")[0];if(this.config.style.theme&&"default"==this.config.style.theme)try{t.code==Shopify.locale&&(i=t.translation)}catch(t){console.log("Shopify undefine")}else r&&e==r&&(i=t.translation)}),i||t},getQueryVariable(e){let t=window.location.search.substring(1);var i=(t=t.split("?")[0]).split("&");for(let t=0;t<i.length;t++){var r=i[t].split("=");if(r[0]==e)return r[1]}return""},getParams(t){fetch(`${this.baseUrl}/endApi/api/order/anonymous/get-order-no?track_number=${encodeURIComponent(t)}&store_domain=`+this.storeDomain,{method:"GET",headers:{Accept:"application/json, */*","Content-Type":"application/json;charset=utf8"}}).then(t=>t.json()).then(e=>{this.showPowerBy=e.show_power_by,setTimeout(()=>{var t=document.getElementById("track123-powered-by");t&&e.show_power_by&&(t.innerHTML="Powered by Track123")},500),t&&(this.formParams.tracking_no=t,this.formParams.tracking_no_or_order_number=t,this.isGoSearch||(this.config.configure_options.lookup_options_by_order_number_and_email&&this.config.configure_options.lookup_options_by_tracking_number&&!this.config.configure_options.require_email_or_phone_number?this.submit(4):this.submit(2))),e.order_detail_list&&e.order_detail_list.length&&(this.formParams.email=e.order_detail_list[0].email,this.formParams.order_or_number=e.order_detail_list[0].order_name)})},checkData(t){let e=!0;return 1===t?(e=this.formParams.email&&this.formParams.order_or_number,this.showEmailError=!this.formParams.email,this.showOrderError=!this.formParams.order_or_number):2===t?(e=this.formParams.tracking_no,this.showTrackingNoError=!this.formParams.tracking_no):3===t?(e=this.formParams.order_or_number,this.showOrderError=!this.formParams.order_or_number):4===t&&(e=this.formParams.tracking_no_or_order_number,this.showTrackingNoOrOrderNumberError=!this.formParams.tracking_no_or_order_number),e},getFormData(t){var e=window.TRACK123_BASE64;let i={source_type:1,select_type:t,store_domain:this.storeDomain};window.location.href;var r=window.location.href.split("?")[0];return 1===t?(i={...i,email:this.formParams.email,order_or_number:this.formParams.order_or_number},window.history&&history.replaceState(null,"",`${r}?order=${encodeURIComponent(i.order_or_number)}&id=`+e.encode(i.email))):2==t?(i={...i,tracking_no:this.formParams.tracking_no?this.formParams.tracking_no.replace(/\s*/g,""):""},window.history&&history.replaceState(null,"",r+"?nums="+encodeURIComponent(i.tracking_no))):3==t?(i={...i,order_or_number:this.formParams.order_or_number},window.history&&history.replaceState(null,"",r+"?order="+encodeURIComponent(i.order_or_number))):4==t&&(i={...i,pattern_word:this.formParams.tracking_no_or_order_number},window.history)&&history.replaceState(null,"",r+"?nums="+encodeURIComponent(i.pattern_word)),i},getPreviewProductRecommendationList(t){fetch(this.baseUrl+"/endApi/api/recommendations/products/example",{method:"GET",headers:{Accept:"application/json, */*","Content-Type":"application/json;charset=utf8"}}).then(t=>t.ok?t.json():!!t.ok&&void 0).then(t=>{t.products.forEach(t=>{t.imageUrl=t.images[0],t.price=100*t.price,t.compare_at_price&&(t.compare_at_price=100*t.compare_at_price)}),this.$emit("getProductRecommendations",t.products)})},getProductRecommendationList(t){const i=t.preview;let e="";if(!i||t.recommand_product&&0!=t.recommand_product.recommend_id){if(t&&t.recommand_product&&t.recommand_product.recommendation_type&&1==t.recommand_product.recommendation_type&&"0"!==t.recommand_product.recommend_id){if(!t.recommand_product.recommend_id)return void this.$emit("getProductRecommendations",null);e=`/recommendations/products.json?product_id=${t.recommand_product.recommend_id}&limit=10`}else e=this.baseUrl+"/endApi/api/recommendProduct?storeDomain="+this.storeDomain;fetch(e,{method:"GET",headers:{Accept:"application/json, */*","Content-Type":"application/json;charset=utf8"}}).then(t=>t.ok?t.json():!!t.ok&&void 0).then(e=>{if(e){let t=null;e&&e.products?(t=e.products).forEach(t=>{t.imageUrl=t.images[0],t.price=(t.variants&&t.variants.length?t.variants[0]:t).price,t.compare_at_price&&(t.compare_at_price=(t.variants&&t.variants.length?t.variants[0]:t).compare_at_price)}):e&&e.data&&e.data.products&&(t=e.data.products).forEach(t=>{t.imageUrl=t.images&&t.images.length?t.images[0].src:"",t.price=(t.variants&&t.variants.length?t.variants[0]:t).price,t.price=100*parseFloat(t.price),t.compare_at_price&&(t.compare_at_price=(t.variants&&t.variants.length?t.variants[0]:t).compare_at_price,t.compare_at_price=100*parseFloat(t.compare_at_price))}),this.$emit("getProductRecommendations",t)}else i&&this.getPreviewProductRecommendationList(t)})}else this.getPreviewProductRecommendationList(t)},getProductDetail(t){const e=JSON.parse(JSON.stringify(t)),i=[],r=[],a={};e.order_packages.forEach(t=>{t.order_items&&t.order_items.length&&t.order_items.forEach(t=>{t.product_id&&"0"!=t.product_id&&(t.variant_id&&!r.includes(t.variant_id)||!t.variant_id&&!r.includes(t.product_id))&&(r.push(t.variant_id||t.product_id),i.push({product_id:t.product_id,variant_id:t.variant_id||0}))})}),fetch(this.baseUrl+"/endApi/api/product/info",{method:"POST",body:JSON.stringify({products:i,store_domain:this.storeDomain,domain:t.domain,customer_id:t.customer_id,review_type:t.review_type}),headers:{Accept:"application/json, */*","Content-Type":"application/json;charset=utf8"}}).then(t=>t.json()).then(t=>{"00000"===t.code&&(t.data.forEach(t=>{a[t.variant_id||t.product_id]=t}),e.order_packages.forEach(t=>{t.order_items&&t.order_items.length&&t.order_items.forEach(t=>{var e=a[t.variant_id||t.product_id];e&&(t.product_image=e.img_url,t.product_url=e.product_url,t.review_url=e.review_url)})}),this.$emit("getOrderDetail",e))})},submit(t){this.checkData(t)&&(this.showErrorText=!1,this.showLoading=!0,t=this.getFormData(t),fetch(this.baseUrl+"/endApi/api/order/anonymous-query",{method:"POST",body:JSON.stringify(t),headers:{Accept:"application/json, */*","Content-Type":"application/json;charset=utf8"}}).then(t=>t.ok?t.json():!!t.ok&&void 0).then(t=>{!t||(this.showErrorText=t.no_query_data,this.loadTrackPageCss(),t.no_query_data)?this.$emit("getOrderDetail",null):(this.$emit("getOrderDetail",t),t.preview||this.getProductDetail(t),this.getProductRecommendationList(t),setTimeout(()=>{var t=document.getElementById("track123_order_header");t&&t.scrollIntoView({behavior:"smooth"})},500))}).finally(()=>this.showLoading=!1))},openPoweredByLink(){window.open("https://apps.shopify.com/track123?surface_detail=Shopify_Tracking_Page")},loadTrackPageCss(){window.isTrack123Page&&!window.hasLoadTrack123PageCss&&document.getElementById("track123-app").offsetWidth<1200&&(window.hasLoadTrack123PageCss=!0,this.loadCss(window.track123BaseUrl+"/tracking-page/build/middleScreen-tradition.min.css?v="+window.track123Version,"screen and (min-width: 834px)"))},loadCss(t,e){var i=document.createElement("link");i.setAttribute("rel","stylesheet"),i.setAttribute("href",t),e&&i.setAttribute("media",e),document.getElementsByTagName("head")[0].appendChild(i)},initGoogleAlign(){setTimeout(()=>{var t=document.getElementsByTagName("select");this.isPhone&&t&&t.length&&!this.config.store_logo_url&&(t[0].style.textAlign="left")},5e3)}}},window.trackOrderDetailMixin={props:["config","orderDetail","productRecommendations"],data(){return{shopifyDomain:"",translation:{},currentLocale:"",configure_options:{},currentPackageIndex:0,showAllTrackingShowDetails:!0,trackingShowDetails:[],trackingDetails:[],trackingLatestDetails:[],isMapCurrent:!1,notShowMap:!1,showOrderSelector:!1,activeProcessBarColor:"",addCartLoadingIndex:null}},computed:{isPhone(){return navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)},baseUrl(){return TRACK_BASE_URL||window.TRACK_BASE_URL},mapLocation(){var t=this.currentPackage&&this.currentPackage.tracking_details&&this.currentPackage.tracking_details.length?this.currentPackage.tracking_details[0].event_location:"",e=this.orderDetail.combined_address||this.currentPackage.ship_to||"";return this.isMapCurrent?t:e},mapUrl(){var t=encodeURIComponent(this.mapLocation);return this.mapLocation?"https://www.google.com/maps/embed/v1/place?key=AIzaSyDf5VCcikU0XbIhQtJ2mOpz6JHHND2Yggk&q="+t:!this.isMapCurrent&&this.orderDetail.latitude&&this.orderDetail.longitude?`https://www.google.com/maps/embed/v1/view?key=AIzaSyDf5VCcikU0XbIhQtJ2mOpz6JHHND2Yggk&zoom=16&center=${this.orderDetail.latitude},`+this.orderDetail.longitude:""},statusMsg(){return"cancelled"==this.orderDetail.status?this.translation.shipping_status.canceled:this.translation.shipping_status[this.currentPackage.transit_display_status]||this.currentPackage.transit_display_status},currentPackage(){return this.orderDetail.order_packages[this.currentPackageIndex]||{}},orderPackageName(){return this.orderDetail&&this.orderDetail.order_packages&&1<this.orderDetail.order_packages.length?this.orderDetail.order_name+"_F"+(this.currentPackageIndex+1):this.orderDetail.order_name},currentCourierLink(){var t;return this.currentPackage.courier?(t=this.currentPackage.courier).query_link?t.query_link.replace(/#{trackingNo}/g,this.currentPackage.tracking_number):t.courier_home_page:""},currentLastCourierLink(){var t;return this.currentPackage.last_mile_info?(t=this.currentPackage.last_mile_info)&&t.query_link?t.query_link.replace(/#{trackingNo}/g,t.lm_track_no):t.courier_home_page:""},expectedDeliveryTime(){let t=null;var e,i,r;return this.currentPackage.expected_delivery&&this.currentPackage.expected_delivery.display_flag&&((e=this.currentPackage.expected_delivery).store_delivery_time_end&&e.store_delivery_time_start?(i=this.getTranslationTime(e.store_delivery_time_start,"date"),r=this.getTranslationTime(e.store_delivery_time_end,"date"),t=i+" - "+r):e.logistic_delivery_time&&(t=this.getTranslationTime(e.logistic_delivery_time,"date"))),t}},created(){try{this.shopifyDomain=Shopify.shop||this.config.shopify_domain}catch(t){this.shopifyDomain=this.config.shopify_domain||TRACK_DOMAIN||window.TRACK_DOMAIN}var{translation:t,currentLocale:e}=this.getTranslation(),{trackingDetails:t,trackingLatestDetails:e}=(this.translation=t,this.currentLocale=e,this.configure_options={...this.config.configure_options},this.activeProcessBarColor=this.config.style.process_bar_color,this.isMapCurrent="configure_options.map_coordinates.current_package_location"===this.configure_options.map_coordinates,this.notShowMap="configure_options.map_coordinates.do_not_show_map"===this.configure_options.map_coordinates,this.getTrackingDetails());this.trackingDetails=t,this.trackingLatestDetails=e,this.showAllTrackingShowDetails=this.configure_options.tracking_detail_show_all,this.trackingShowDetails=this.showAllTrackingShowDetails?this.trackingDetails:this.trackingLatestDetails,this.translateDetail()},watch:{orderDetail(t){var e;t&&({trackingDetails:t,trackingLatestDetails:e}=this.getTrackingDetails(),this.currentPackageIndex=0,this.trackingDetails=t,this.trackingLatestDetails=e,this.showAllTrackingShowDetails=this.configure_options.tracking_detail_show_all,this.trackingShowDetails=this.showAllTrackingShowDetails?this.trackingDetails:this.trackingLatestDetails,this.translateDetail())}},methods:{toggleOrderSelector(){this.showOrderSelector=!this.showOrderSelector},selectOrderPackage(t){this.currentPackageIndex=t},getModernMultiLanguage(){if(!this.config.style||"modern"==this.config.style.theme){let t="";var e=window.location.href.split("/");return t=["apps","a","community","tools"].includes(e[3])?t:(t=e[3])&&t.split("-")[0]}},getTranslation(){let i=null;const r=this.getModernMultiLanguage();let a=this.config.translation_configs&&this.config.translation_configs.translation_configs?this.config.translation_configs.translation_configs[0].code:"";var t=this.config.translation_configs&&this.config.translation_configs.translation_configs&&this.config.translation_configs.translation_configs.length?this.config.translation_configs.translation_configs[0].translation:{};this.config.translation_configs.func_permission||this.config.translation_configs.plan;return this.config.translation_configs.translation_configs.forEach(t=>{var e=t.code.split("-")[0];if(this.config.style.theme&&"default"==this.config.style.theme)try{t.code==Shopify.locale&&(i=t.translation,a=Shopify.locale)}catch(t){console.log("Shopify undefine")}else r&&e==r&&(i=t.translation,a=t.code)}),{translation:i=i||t,currentLocale:a}},uploadMarketing(t,e){fetch(this.baseUrl+"/endApi/api/upload-marketing",{method:"POST",body:JSON.stringify({click_type:"reorder"==e?2:3,store_domain:this.shopifyDomain,page_session_id:window.TRACK_PAGE_SESSION_ID,product_id:t.product_id,variant_id:t.variant_id||""}),headers:{Accept:"application/json, */*","Content-Type":"application/json;charset=utf8"}})},goProductDetail(t,e,i){var r;this.orderDetail.preview||t&&(!t.product_id||"0"==t.product_id)||(this.uploadMarketing(t,e),"review"===e&&t.review_url?(r=t.review_url.includes("?")?"&":"?",window.open(t.review_url+r+"ref=track123&utm_source=track123&utm_medium=tracking_page")):"reorder"===e&&window.open(`/cart/${t.variant_id}:1?utm_source=track123_reorder`))},getTranslationTime(e,t){if(!e)return"";let i="";if("date"==t){let t="modern"!==this.config.style.theme?this.config.date_formatEnum.momentJsFormat:"DD MMM";i=dayjs(e).format(t),t.includes("Do")&&(t=t.replace("Do","D*"),r={1:"st",2:"nd",3:"rd"}[dayjs(e).format("D")]||"th",i=(i=dayjs(e).format(t)).replace("*",r)),t.includes("MMM")&&(r=dayjs(e).format("MMM"),this.translation.time["month_"+r.toLowerCase()])&&(i=i.replace(r,this.translation.time["month_"+r.toLowerCase()]))}else{var r;"time"==t&&(r=this.config.time_formatEnum.momentJsFormat,i=dayjs(e).format(r),r.includes("a"))&&(t=dayjs(e).format("a"),this.translation.time["time_"+t])&&(i=i.replace(t,this.translation.time["time_"+t]))}return i},translateDetail(){if(this.orderDetail.translate_track){const r=JSON.parse(JSON.stringify(this.orderDetail));var t=r.order_packages.map(t=>{var e,i=JSON.parse(JSON.stringify(t.tracking_details));return t.last_mile_info&&t.last_mile_info.lm_track_no&&t.last_mile_info.lm_track_no_provider_name&&(i[e=i.length-1].event_detail=`${i[e].event_detail}. Last mile tracking number: ${t.last_mile_info.lm_track_no} - Last mile tracking carrier: `+t.last_mile_info.lm_track_no_provider_name),{order_package_id:t.order_package_id_str||t.order_package_id,tracking_details:i,last_mile_info_details:t.last_mile_info?t.last_mile_info.details:null}}),e=Date.now().toString();fetch(this.baseUrl+"/endApi/api/track/translate",{method:"POST",body:JSON.stringify({order_packages:t,to_language:this.currentLocale,myshopify_domain:this.shopifyDomain}),headers:{Accept:"application/json, */*","Content-Type":"application/json;charset=utf8",Timestamp:e,Signature:md5(""+this.orderDetail.store_id+this.currentLocale+e)}}).then(t=>t.json()).then(i=>{var t,e;"00000"===i.code&&i.data&&i.data.length&&(r.order_packages.forEach((t,e)=>{i.data[e].tracking_details&&i.data[e].tracking_details.length&&(t.tracking_details=i.data[e].tracking_details),i.data[e].last_mile_info_details&&i.data[e].last_mile_info_details.length&&(t.last_mile_info.details=i.data[e].last_mile_info_details)}),{trackingDetails:t,trackingLatestDetails:e}=this.getTrackingDetails(r),this.trackingDetails=t,this.trackingLatestDetails=e,this.trackingShowDetails=this.showAllTrackingShowDetails?this.trackingDetails:this.trackingLatestDetails)})}},getTrackingDetails(t){t=JSON.parse(JSON.stringify(t||this.orderDetail));if(!t.order_packages&&!t.order_packages.length)return{trackingDetails:[],trackingLatestDetails:[]};let a=[],s=[];return t.order_packages.forEach(e=>{let i=[],o={},n={};const r=e.automatic_order_update||!e.hasOwnProperty("automatic_order_update");e.tracking_status_list.forEach(t=>{(r&&1==t.type&&t.event_time||!r&&t.event_time)&&i.push({sort:dayjs(t.event_time).format("YYYYMMDDHHmmss"),event_time:t.event_time,event_detail:t.status_desc||this.translation.shipping_status[t.status_name]||t.status_name})}),e&&e.courier&&e.courier.courier_name_e_n&&e.tracking_details.forEach(t=>{t.sort=dayjs(t.event_time).format("YYYYMMDDHHmmss"),t.courier_name=e.courier.courier_name_e_n}),!this.orderDetail.translate_track&&e.last_mile_info&&e.last_mile_info.lm_track_no&&e.last_mile_info.lm_track_no_provider_name&&(t=e.tracking_details.length-1,e.tracking_details[t].event_detail=`${e.tracking_details[t].event_detail}. Last mile tracking number: ${e.last_mile_info.lm_track_no} - Last mile tracking carrier: `+e.last_mile_info.lm_track_no_provider_name),e&&e.last_mile_info&&e.last_mile_info.details&&e.last_mile_info.details.length&&e.last_mile_info.lm_track_no_provider_name&&(e.last_mile_info_details=e.last_mile_info.details.map(t=>(t.sort=dayjs(t.event_time).format("YYYYMMDDHHmmss"),t.courier_name=e.last_mile_info.lm_track_no_provider_name,t))),i=e.tracking_details&&r?[...e.tracking_details,...i]:[...i],(i=(i=(i=e&&e.last_mile_info_details?[...e.last_mile_info_details,...i]:i).reverse()).sort((t,e)=>e.sort-t.sort)).map((t,e)=>{var i=t.event_time,r=dayjs(i).format("YYYYMMDD"),a=this.getTranslationTime(i,"date");t.event_time=this.getTranslationTime(i,"time"),o[r]||(o[r]={time:a,child:[]}),o[r].child.push(t),e<3&&(n[r]||(n[r]={time:a,child:[]}),n[r].child.push(t))}),i=Object.values(o).reverse(),a.push(i);var t=Object.values(n).reverse();s.push(t)}),{trackingDetails:a,trackingLatestDetails:s}},viewMoreToggle(){var t;this.showAllTrackingShowDetails=!this.showAllTrackingShowDetails,this.trackingShowDetails=this.showAllTrackingShowDetails?this.trackingDetails:this.trackingLatestDetails,this.showAllTrackingShowDetails||(t=document.getElementById("track123_order_detail_title"))&&t.scrollIntoView({behavior:"smooth"})}}};